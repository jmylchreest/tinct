# Tinct Template Guide

Complete guide to using templates in tinct output plugins, including all available functions, color access patterns, and iteration methods.

## Table of Contents

- [Quick Start](#quick-start)
- [Template Functions](#template-functions)
- [Color Access](#color-access)
- [Format Conversion](#format-conversion)
- [Alpha Channel Support](#alpha-channel-support)
- [Iteration and Loops](#iteration-and-loops)
- [Complete Color Role List](#complete-color-role-list)
- [External Plugin Integration](#external-plugin-integration)
- [Examples](#examples)

---

## Quick Start

### Basic Template Structure

```go
# Generated by Tinct
# Theme: {{ themeType . }}

# Background and foreground
background {{ get . "background" | hex }}
foreground {{ get . "foreground" | hex }}

# Accent colors
accent1 {{ get . "accent1" | hex }}
accent2 {{ get . "accent2" | hex }}

# With alpha transparency
overlay {{ get . "scrim" | rgba }}
```

### Template Data

Templates receive a `*colour.PaletteHelper` instance that provides access to all colors in the palette.

---

## Template Functions

### Color Access Functions

#### `get <palette> <role>`
Get a color by role name. **Panics if role doesn't exist** - use `has` to check first.

```go
{{ get . "background" }}          // Returns ColorValue
{{ get . "accent1" | hex }}       // Returns #RRGGBB
```

#### `getSafe <palette> <role>`
Safely get a color by role. Returns error if role doesn't exist.

```go
{{ $color, $err := getSafe . "customRole" }}
{{ if $err }}
    # Role not found
{{ else }}
    color {{ $color | hex }}
{{ end }}
```

#### `has <palette> <role>`
Check if a role exists in the palette.

```go
{{ if has . "border" }}
border {{ get . "border" | hex }}
{{ else }}
border {{ get . "outline" | hex }}
{{ end }}
```

#### `getByIndex <palette> <index>`
Get color by index in the `AllColors` array (sorted by luminance).

```go
{{ $color, $err := getByIndex . 0 }}
color0 {{ $color | hex }}
```

#### `ansi <palette> <colorName>`
Find the closest color to a standard ANSI terminal color name. **Panics if color name is invalid** - use `ansiSafe` to check first.

Supported color names:
- **Standard**: `black`, `red`, `green`, `yellow`, `blue`, `magenta`, `cyan`, `white`
- **Bright**: `brightblack`, `brightred`, `brightgreen`, `brightyellow`, `brightblue`, `brightmagenta`, `brightcyan`, `brightwhite`
- **Aliases**: `color0`-`color15`, `gray`, `grey`, `purple`, `darkgray`, `darkgrey`, etc.
- **Extended**: `orange`, `pink`, `brown`, `lime`, `navy`, `teal`, `maroon`, `olive`, `violet`, `indigo`

```go
# Map ANSI terminal colors to palette
color0 {{ ansi . "black" | hex }}         # Closest to black
color1 {{ ansi . "red" | hex }}           # Closest to red
color2 {{ ansi . "green" | hex }}         # Closest to green
color4 {{ ansi . "blue" | hex }}          # Closest to blue
```

**How it works**: Finds the color in your palette that is perceptually closest to the requested ANSI color using color distance calculation (weighted Euclidean distance in RGB space).

```go
# Example: Terminal color scheme
{{ range $i, $name := list "black" "red" "green" "yellow" "blue" "magenta" "cyan" "white" }}
color{{ $i }} {{ ansi $ $name | hex }}
{{ end }}

{{ range $i, $name := list "brightblack" "brightred" "brightgreen" "brightyellow" "brightblue" "brightmagenta" "brightcyan" "brightwhite" }}
color{{ add $i 8 }} {{ ansi $ $name | hex }}
{{ end }}
```

#### `ansiSafe <palette> <colorName>`
Safely find the closest ANSI color. Returns error if color name is not recognized.

```go
{{ $color, $err := ansiSafe . "customColorName" }}
{{ if $err }}
    # Color name not recognized
{{ else }}
    color {{ $color | hex }}
{{ end }}
```

### Format Conversion Functions

All format functions take a `ColorValue` and return a formatted string.

#### `hex <color>`
Returns `#RRGGBB` format (no alpha).

```go
{{ get . "background" | hex }}
# Output: #1e1e2e
```

#### `hexAlpha <color>`
Returns `#RRGGBBAA` format (with alpha).

```go
{{ get . "scrim" | hexAlpha }}
# Output: #00000052
```

#### `hexNoHash <color>`
Returns `RRGGBB` format (no # prefix, no alpha).

```go
{{ get . "accent1" | hexNoHash }}
# Output: 89b4fa
```

#### `rgb <color>`
Returns CSS `rgb(r,g,b)` format (no alpha).

```go
{{ get . "background" | rgb }}
# Output: rgb(30, 30, 46)
```

#### `rgba <color>`
Returns CSS `rgba(r,g,b,a)` format (with alpha).

```go
{{ get . "scrim" | rgba }}
# Output: rgba(0, 0, 0, 0.32)
```

#### `rgbDecimal <color>`
Returns `r,g,b` decimal format (for Hyprland, no alpha).

```go
{{ get . "accent1" | rgbDecimal }}
# Output: 137,180,250
```

### Alpha Manipulation

#### `withAlpha <color> <alpha>`
Returns a new ColorValue with specified alpha (0.0-1.0).

```go
{{ get . "background" | withAlpha 0.85 | rgba }}
# Output: rgba(30, 30, 46, 0.85)

{{ get . "accent1" | withAlpha 0.5 | hexAlpha }}
# Output: #89b4fa80
```

### Metadata Functions

#### `role <color>`
Get the role name of a color.

```go
{{ $color := get . "background" }}
{{ role $color }}
# Output: background
```

#### `index <color>`
Get the index of a color in AllColors array.

```go
{{ $color := get . "accent1" }}
{{ index $color }}
# Output: 4
```

#### `themeType <palette>`
Get theme type string ("dark" or "light").

```go
{{ themeType . }}
# Output: dark
```

#### `count <palette>`
Get total number of colors in palette.

```go
{{ count . }}
# Output: 49
```

---

## Color Access

### By Role Name

```go
# Core colors
{{ get . "background" | hex }}
{{ get . "foreground" | hex }}

# Accents
{{ get . "accent1" | hex }}
{{ get . "accent2" | hex }}

# Semantic
{{ get . "danger" | hex }}
{{ get . "warning" | hex }}

# Surface
{{ get . "surface" | hex }}
{{ get . "onSurface" | hex }}
```

### By Index

```go
# ANSI color palette (indexed by luminance)
{{- range $i := 0 }}{{ if lt $i 16 }}
{{- $color, _ := getByIndex . $i }}
color{{ $i }} {{ $color | hex }}
{{- end }}{{ end }}
```

### With Fallbacks

```go
# Use border if available, otherwise outline
{{ if has . "border" }}
border {{ get . "border" | hex }}
{{ else }}
border {{ get . "outline" | hex }}
{{ end }}
```

---

## Format Conversion

### Multiple Formats from Same Color

```go
{{- $bg := get . "background" }}

# Different representations
HEX:       {{ $bg | hex }}
HEX_ALPHA: {{ $bg | hexAlpha }}
RGB:       {{ $bg | rgb }}
RGBA:      {{ $bg | rgba }}
NO_HASH:   {{ $bg | hexNoHash }}
DECIMAL:   {{ $bg | rgbDecimal }}
```

### Platform-Specific Formats

```go
# Kitty/Alacritty (hex)
background {{ get . "background" | hex }}

# Hyprland (rgb decimal or rgba)
$background = rgb({{ get . "background" | rgbDecimal }})
$backgroundAlpha = rgba({{ get . "background" | rgbDecimal }}, {{ (get . "background").AlphaFloat }})

# CSS (rgba)
background-color: {{ get . "background" | rgba }};

# Dunst (hex with alpha)
background = "{{ get . "background" | withAlpha 0.9 | hexAlpha }}"
```

---

## Alpha Channel Support

### Colors with Default Alpha

Most colors have alpha = 255 (fully opaque) by default. Two exceptions:

- **scrim**: alpha = 82 (~32% opacity) - for modal overlays
- **shadow**: alpha = 38 (~15% opacity) - for elevation shadows

```go
# Scrim (already has alpha)
{{ get . "scrim" | rgba }}
# Output: rgba(0, 0, 0, 0.32)

# Shadow (already has alpha)
{{ get . "shadow" | rgba }}
# Output: rgba(0, 0, 0, 0.15)
```

### Custom Alpha Values

```go
# Semi-transparent background
{{ get . "background" | withAlpha 0.85 | rgba }}
# Output: rgba(30, 30, 46, 0.85)

# Transparent accent for overlays
{{ get . "accent1" | withAlpha 0.3 | hexAlpha }}
# Output: #89b4fa4d

# Multiple transparency levels
selection_bg {{ get . "accent1" | withAlpha 0.3 | hex }}
hover_bg     {{ get . "accent1" | withAlpha 0.5 | hex }}
active_bg    {{ get . "accent1" | hex }}
```

---

## Iteration and Loops

### All Semantic Roles

```go
{{ range allRoles . }}
# {{ . }}: {{ get $ . | hex }}
{{ end }}
```

Output:
```
# background: #1e1e2e
# foreground: #cdd6f4
# accent1: #89b4fa
...
```

### All Colors by Index

```go
{{ range $i, $color := allColors . }}
color{{ $i }} {{ $color | hex }}  # {{ role $color }}
{{ end }}
```

Output:
```
color0 #1e1e2e  # background
color1 #cdd6f4  # foreground
color2 #89b4fa  # accent1
...
```

### Filtered Iteration

```go
# Only accent colors
{{ range allRoles . }}
{{- if hasPrefix . "accent" }}
{{ . }}: {{ get $ . | hex }}
{{- end }}
{{ end }}
```

### ANSI Color Palette

```go
# Standard 16-color ANSI palette
{{ $colors := list 
    "background" "foreground" "backgroundMuted" "foregroundMuted"
    "accent1" "accent1Muted" "accent2" "accent2Muted"
    "accent3" "accent3Muted" "accent4" "accent4Muted"
    "danger" "warning" "success" "info" }}

{{ range $i, $role := $colors }}
color{{ $i }} {{ get $ $role | hex }}
{{ end }}
```

---

## Complete Color Role List

### Core Colors (4)
```
background          # Base background color
backgroundMuted     # Muted/inactive background
foreground          # Primary text color  
foregroundMuted     # Secondary/dimmed text
```

### Accent Colors (8)
```
accent1             # Primary accent
accent1Muted        # Muted variant
accent2             # Secondary accent
accent2Muted        # Muted variant
accent3             # Tertiary accent
accent3Muted        # Muted variant
accent4             # Quaternary accent
accent4Muted        # Muted variant
```

### Semantic Colors (5)
```
danger              # Error/destructive actions (red)
warning             # Warnings/caution (orange)
success             # Success/confirmation (green)
info                # Information (blue)
notification        # Notifications (purple)
```

### Surface Colors - Priority 1 (4)
```
surface             # Card/sheet backgrounds
onSurface           # Text on surface
outline             # Borders/dividers
border              # Primary borders
```

### Surface Variants - Priority 2 (4)
```
surfaceVariant      # Alternate surface
onSurfaceVariant    # Text on surface variant
borderMuted         # Inactive borders
outlineVariant      # Secondary outlines
```

### On-Colors for Accents - Priority 2 (4)
```
onAccent1           # Text on accent1 background
onAccent2           # Text on accent2 background
onAccent3           # Text on accent3 background
onAccent4           # Text on accent4 background
```

### On-Colors for Semantics - Priority 2 (4)
```
onDanger            # Text on danger background
onWarning           # Text on warning background
onSuccess           # Text on success background
onInfo              # Text on info background
```

### Inverse Colors - Priority 3 (3)
```
inverseSurface      # Tooltip/inverse surface
inverseOnSurface    # Text on inverse surface
inversePrimary      # Inverse accent color
```

### Overlay Colors - Priority 3 (2)
```
scrim               # Modal backdrop (alpha=0.32)
shadow              # Elevation shadow (alpha=0.15)
```

### Container Elevation - Priority 3 (5)
```
surfaceContainerLowest   # Elevation level 0
surfaceContainerLow      # Elevation level 1
surfaceContainer         # Elevation level 2
surfaceContainerHigh     # Elevation level 3
surfaceContainerHighest  # Elevation level 4
```

### Positional Colors (30+)

Used for ambient lighting effects:

```
# Core 8 positions
positionTopLeft, positionTop, positionTopRight, positionRight
positionBottomRight, positionBottom, positionBottomLeft, positionLeft

# Extended 12+ regions (varies by configuration)
positionTopLeftInner, positionTopCenter, positionTopRightInner
positionCenterLeft, positionCenter, positionCenterRight
positionBottomLeftInner, positionBottomCenter, positionBottomRightInner
# ... and more based on --image.regions setting
```

**Total**: 49 semantic roles + 30+ positional roles = **79+ colors**

---

## External Plugin Integration

### JSON Palette Format

External plugins receive a JSON palette with this structure:

```json
{
  "colours": {
    "background": {
      "role": "background",
      "hex": "#1e1e2e",
      "rgb": {"r": 30, "g": 30, "b": 46},
      "rgba": {"r": 30, "g": 30, "b": 46, "a": 255},
      "luminance": 0.027,
      "is_light": false,
      "hue": 240,
      "saturation": 0.21,
      "index": 0,
      "is_generated": false,
      "weight": 0.42
    },
    "scrim": {
      "role": "scrim",
      "hex": "#000000",
      "rgb": {"r": 0, "g": 0, "b": 0},
      "rgba": {"r": 0, "g": 0, "b": 0, "a": 82},
      "luminance": 0.0,
      "is_light": false,
      "index": 30,
      "is_generated": true,
      "weight": 0.0
    }
  },
  "theme_type": "dark",
  "all_colours": [
    {
      "role": "background",
      "hex": "#1e1e2e",
      "rgba": {"r": 30, "g": 30, "b": 46, "a": 255},
      "index": 0
    }
  ]
}
```

### Key Fields

- **`colours`**: Map of role name to color object
- **`rgba`**: **NEW** - Always includes alpha channel (0-255)
- **`rgb`**: Legacy field (backwards compatible, no alpha)
- **`hex`**: Always `#RRGGBB` format (no alpha)
- **`theme_type`**: "dark" or "light"
- **`all_colours`**: Array sorted by luminance (for ANSI palettes)

### External Plugin Implementation

#### Go Plugins

```go
type CategorisedPalette struct {
    Colours    map[string]CategorisedColour `json:"colours"`
    ThemeType  string                        `json:"theme_type"`
    AllColours []CategorisedColour          `json:"all_colours"`
}

type CategorisedColour struct {
    Role       string  `json:"role"`
    Hex        string  `json:"hex"`           // #RRGGBB
    RGB        RGB     `json:"rgb"`           // Legacy
    RGBA       RGBA    `json:"rgba"`          // NEW: with alpha
    Luminance  float64 `json:"luminance"`
    IsLight    bool    `json:"is_light"`
    Index      int     `json:"index"`
    IsGenerated bool   `json:"is_generated"`
}

type RGBA struct {
    R uint8 `json:"r"`
    G uint8 `json:"g"`
    B uint8 `json:"b"`
    A uint8 `json:"a"`  // 0-255
}

// Helper methods
func (rgba RGBA) AlphaFloat() float64 {
    return float64(rgba.A) / 255.0
}

func (rgba RGBA) HexAlpha() string {
    return fmt.Sprintf("#%02x%02x%02x%02x", rgba.R, rgba.G, rgba.B, rgba.A)
}

func (rgba RGBA) CSSRgba() string {
    return fmt.Sprintf("rgba(%d, %d, %d, %.2f)", rgba.R, rgba.G, rgba.B, rgba.AlphaFloat())
}
```

#### Python Plugins

```python
import json

class RGBA:
    def __init__(self, r, g, b, a=255):
        self.r = r
        self.g = g
        self.b = b
        self.a = a
    
    def alpha_float(self):
        return self.a / 255.0
    
    def hex_alpha(self):
        return f"#{self.r:02x}{self.g:02x}{self.b:02x}{self.a:02x}"
    
    def css_rgba(self):
        return f"rgba({self.r}, {self.g}, {self.b}, {self.alpha_float():.2f})"

def load_palette(json_path):
    with open(json_path) as f:
        data = json.load(f)
    
    palette = {}
    for role, color in data['colours'].items():
        rgba = color['rgba']
        palette[role] = RGBA(rgba['r'], rgba['g'], rgba['b'], rgba['a'])
    
    return palette, data['theme_type']

# Usage
palette, theme = load_palette('palette.json')
print(palette['background'].hex_alpha())  # #1e1e2eff
print(palette['scrim'].css_rgba())        # rgba(0, 0, 0, 0.32)
```

#### Shell Script Plugins

```bash
#!/bin/bash

# Parse JSON with jq
PALETTE_JSON="$1"

# Get color with alpha
get_color() {
    local role="$1"
    local format="${2:-hex}"  # hex, rgba, hex_alpha
    
    local r=$(jq -r ".colours.\"$role\".rgba.r" "$PALETTE_JSON")
    local g=$(jq -r ".colours.\"$role\".rgba.g" "$PALETTE_JSON")
    local b=$(jq -r ".colours.\"$role\".rgba.b" "$PALETTE_JSON")
    local a=$(jq -r ".colours.\"$role\".rgba.a" "$PALETTE_JSON")
    
    case "$format" in
        hex)
            printf "#%02x%02x%02x\n" "$r" "$g" "$b"
            ;;
        hex_alpha)
            printf "#%02x%02x%02x%02x\n" "$r" "$g" "$b" "$a"
            ;;
        rgba)
            local alpha=$(awk "BEGIN {printf \"%.2f\", $a/255.0}")
            printf "rgba(%d, %d, %d, %s)\n" "$r" "$g" "$b" "$alpha"
            ;;
    esac
}

# Usage
BG=$(get_color "background" "hex")
SCRIM=$(get_color "scrim" "rgba")

echo "background: $BG"
echo "scrim: $SCRIM"
```

---

## Examples

### Complete Kitty Theme

```go
# Kitty theme generated by Tinct
# Theme: {{ themeType . }}

# Basic colors
foreground {{ get . "foreground" | hex }}
background {{ get . "background" | hex }}

# Selection with alpha
selection_foreground {{ get . "background" | hex }}
selection_background {{ get . "accent1" | withAlpha 0.3 | hex }}

# Cursor
cursor {{ get . "accent1" | hex }}
cursor_text_color {{ get . "background" | hex }}

# Borders
{{- if has . "border" }}
active_border_color {{ get . "border" | hex }}
{{- else }}
active_border_color {{ get . "outline" | hex }}
{{- end }}

# ANSI colors
{{- $roles := list "background" "foreground" "backgroundMuted" "foregroundMuted" 
    "accent1" "accent1Muted" "accent2" "accent2Muted"
    "accent3" "accent3Muted" "accent4" "accent4Muted"
    "danger" "warning" "success" "info" }}
{{- range $i, $role := $roles }}
color{{ $i }} {{ get $ $role | hex }}
{{- end }}
```

### Hyprland Theme

```go
# Hyprland colors - Tinct generated
# Theme: {{ themeType . }}

{{- $bg := get . "background" }}
{{- $fg := get . "foreground" }}
{{- $accent := get . "accent1" }}

$background = rgb({{ $bg | rgbDecimal }})
$foreground = rgb({{ $fg | rgbDecimal }})
$accent = rgb({{ $accent | rgbDecimal }})

# With alpha
$backgroundAlpha = rgba({{ $bg | rgbDecimal }}, 0.85)
$overlay = rgba({{ get . "scrim" | rgbDecimal }}, {{ (get . "scrim").AlphaFloat }})
```

### CSS Stylesheet

```css
/* Tinct theme - {{ themeType . }} */

:root {
  /* Core colors */
  --color-background: {{ get . "background" | hex }};
  --color-foreground: {{ get . "foreground" | hex }};
  
  /* Surfaces */
  --color-surface: {{ get . "surface" | hex }};
  --color-on-surface: {{ get . "onSurface" | hex }};
  
  /* Accents */
  --color-accent1: {{ get . "accent1" | hex }};
  --color-accent2: {{ get . "accent2" | hex }};
  
  /* Semantic */
  --color-danger: {{ get . "danger" | hex }};
  --color-success: {{ get . "success" | hex }};
  
  /* With alpha */
  --color-overlay: {{ get . "scrim" | rgba }};
  --color-shadow: {{ get . "shadow" | rgba }};
  --color-surface-hover: {{ get . "surface" | withAlpha 0.8 | rgba }};
}
```

---

## Tips and Best Practices

### 1. Always Check for Optional Colors

```go
# Good
{{ if has . "border" }}
border {{ get . "border" | hex }}
{{ else }}
border {{ get . "outline" | hex }}
{{ end }}

# Bad (will panic if border doesn't exist)
border {{ get . "border" | hex }}
```

### 2. Use Variables for Repeated Colors

```go
# Good
{{- $bg := get . "background" }}
{{- $fg := get . "foreground" }}

background {{ $bg | hex }}
foreground {{ $fg | hex }}
selection_bg {{ $bg | withAlpha 0.8 | rgba }}

# Bad (repeated lookups)
background {{ get . "background" | hex }}
foreground {{ get . "foreground" | hex }}
selection_bg {{ get . "background" | withAlpha 0.8 | rgba }}
```

### 3. Use Appropriate Format for Platform

```go
# Kitty/Alacritty: hex
background {{ get . "background" | hex }}

# Hyprland: rgb decimal
$background = rgb({{ get . "background" | rgbDecimal }})

# CSS: rgba
background-color: {{ get . "background" | rgba }};

# Dunst: hex with alpha
background = "{{ get . "background" | withAlpha 0.9 | hexAlpha }}"
```

### 4. Leverage AllRoles for Complete Coverage

```go
# Generate all colors
{{ range allRoles . }}
{{ . }} = {{ get $ . | hex }}
{{ end }}
```

---

## Troubleshooting

### Template Syntax Not Processed

**Problem**: Output contains `{{ }}` syntax  
**Solution**: Ensure template parsing includes `Funcs(common.TemplateFuncs())`

```go
tmpl, err := template.New("theme").Funcs(common.TemplateFuncs()).Parse(content)
```

### Panic: Role Not Found

**Problem**: `get` called on non-existent role  
**Solution**: Use `has` to check first

```go
{{ if has . "newRole" }}
{{ get . "newRole" | hex }}
{{ end }}
```

### Wrong Alpha Format

**Problem**: Alpha not appearing in output  
**Solution**: Use correct format function

```go
# Wrong (no alpha)
{{ get . "scrim" | hex }}         # #000000

# Right (includes alpha)
{{ get . "scrim" | hexAlpha }}    # #00000052
{{ get . "scrim" | rgba }}        # rgba(0, 0, 0, 0.32)
```

---

## See Also

- [Plugin Development Guide](../contrib/README.md)
- [Color Role Reference](./COLOR_ROLES.md)
- [External Plugin Integration](./EXTERNAL_PLUGINS.md)
- [Implementation Summary](../IMPLEMENTATION_SUMMARY.md)
