# Hyprpaper Output Plugin

Generate wallpaper configuration for [Hyprpaper](https://github.com/hyprwm/hyprpaper), the wallpaper manager for Hyprland.

## Overview

The Hyprpaper plugin generates a wallpaper configuration file (`tinct-hyprpaper.conf`) and automatically applies the wallpaper when an image source is provided.

## Features

- Automatic wallpaper config generation
- Instant wallpaper application (if hyprpaper is running)
- Preserves existing monitor assignments
- Wildcard and per-monitor support
- Graceful handling when hyprpaper is not running
- Works with or without wallpaper source

## Generated Files

- `tinct-hyprpaper.conf` - Wallpaper preload and assignment configuration

## Default Output Location

```
~/.config/hypr/tinct-hyprpaper.conf
```

## Usage

### With Image Input (Automatic Wallpaper)

When using the `image` input plugin, hyprpaper automatically:
1. Generates config with wallpaper path
2. Applies wallpaper immediately (if hyprpaper is running)
3. Preserves your existing monitor assignments

```bash
# Extract colours and set wallpaper
tinct generate -i image -p ~/Pictures/wallpaper.jpg -o hyprpaper,hyprlock,hyprland

# hyprpaper plugin will:
# - Generate tinct-hyprpaper.conf with preload/wallpaper directives
# - Unload existing wallpapers (clears cache)
# - Preload new wallpaper
# - Apply to all your current monitor assignments
```

### Without Image Input

When using non-image sources, hyprpaper generates a config with helpful placeholders:

```bash
# Generate from remote theme (no wallpaper)
tinct generate -i remote-json \
  --remote-json.url "https://raw.githubusercontent.com/catppuccin/palette/main/palette.json" \
  -o hyprpaper,hyprland

# Config generated with commented examples for manual wallpaper setup
```

## Generated Configuration

### With Wallpaper Source

```conf
# Hyprpaper configuration generated by Tinct

# Preload the wallpaper
preload = /home/user/Pictures/wallpaper.jpg

# Set wallpaper on all monitors (wildcard)
wallpaper = , /home/user/Pictures/wallpaper.jpg

# Optional: Specific monitor assignments
# wallpaper = DP-1, /home/user/Pictures/wallpaper.jpg
# wallpaper = DP-2, /home/user/Pictures/wallpaper.jpg
```

### Without Wallpaper Source

```conf
# Hyprpaper configuration generated by Tinct

# No wallpaper source provided by input plugin
# To use this config, add your wallpaper configuration:
#
# preload = /path/to/wallpaper.jpg
# wallpaper = , /path/to/wallpaper.jpg
#
# Or use specific monitor assignments:
# wallpaper = DP-1, /path/to/wallpaper.jpg
# wallpaper = DP-2, /path/to/wallpaper.jpg

# Splash screen configuration
# splash = false
# splash_offset = 2.0

# IPC configuration
# ipc = on
```

## Integration with Hyprland

### Source in hyprpaper.conf

```conf
# ~/.config/hypr/hyprpaper.conf
source = ~/.config/hypr/tinct-hyprpaper.conf

# Add any additional configuration
splash = false
ipc = on
```

### Launch hyprpaper with Hyprland

```conf
# ~/.config/hypr/hyprland.conf
exec-once = hyprpaper
```

## How Wallpaper Application Works

When a wallpaper source is provided and hyprpaper is running:

1. **Query existing assignments**: Reads `hyprctl hyprpaper listactive` to get current monitor config
2. **Clear cache**: Runs `hyprctl hyprpaper unload all` to ensure fresh image loading
3. **Preload wallpaper**: Runs `hyprctl hyprpaper preload /path/to/wallpaper.jpg`
4. **Apply to monitors**: Uses your existing monitor assignments (wildcard or per-monitor)

This ensures:
- Your monitor configuration is preserved
- Symlinks are handled correctly (cache cleared)
- Wallpaper appears immediately without restart

## Monitor Assignment Modes

### Wildcard Mode (Default)

Applies wallpaper to all monitors:

```conf
wallpaper = , /path/to/wallpaper.jpg
```

### Per-Monitor Mode

Specific assignments for each monitor:

```conf
wallpaper = DP-1, /path/to/wallpaper.jpg
wallpaper = DP-2, /path/to/wallpaper.jpg
wallpaper = eDP-1, /path/to/wallpaper.jpg
```

### Mixed Mode

Combination of specific and wildcard:

```conf
wallpaper = DP-1, /path/to/monitor1.jpg
wallpaper = DP-2, /path/to/monitor2.jpg
wallpaper = , /path/to/default.jpg  # Fallback for other monitors
```

The plugin automatically detects and preserves your existing assignment mode.

## Command Line Options

```bash
# Specify output directory
tinct generate -i image -p wallpaper.jpg --hyprpaper.output-dir ~/.config/hypr

# Enable hyprpaper only
tinct generate -i image -p wallpaper.jpg -o hyprpaper

# Combine with other plugins
tinct generate -i image -p wallpaper.jpg -o hyprpaper,hyprlock,hyprland,kitty
```

## Pre-Execute Check

The plugin performs these checks:

1. If wallpaper path provided: warns if hyprpaper is not running (non-fatal)
2. Creates config directory if it doesn't exist

The plugin will still generate configuration files even if hyprpaper is not running - wallpaper application is simply skipped.

## Behavior Matrix

| Input Plugin | Hyprpaper Running | Result |
|--------------|-------------------|--------|
| `image` | Yes | Config generated + wallpaper applied ✓ |
| `image` | No | Config generated, wallpaper skipped (warning in verbose) |
| `remote-json` | Yes | Config generated with placeholders |
| `remote-json` | No | Config generated with placeholders |

## Troubleshooting

### Wallpaper Not Applied

Check if hyprpaper is running:

```bash
# Check process
pgrep hyprpaper

# Check via hyprctl
hyprctl hyprpaper listloaded

# Start hyprpaper if not running
hyprpaper &
```

### Symlink Not Working

The plugin runs `unload all` before applying wallpapers to clear hyprpaper's cache. This ensures symlink changes are detected.

### Wrong Monitor Assignments

The plugin preserves your existing monitor assignments from `hyprctl hyprpaper listactive`. If you want to change the assignment mode:

1. Manually edit `~/.config/hypr/hyprpaper.conf` or `tinct-hyprpaper.conf`
2. Run `hyprctl reload` or restart hyprpaper
3. Next tinct run will preserve the new assignments

### Verbose Mode

See detailed wallpaper application process:

```bash
tinct generate -i image -p wallpaper.jpg -o hyprpaper --verbose

# Output shows:
# → Running hyprpaper post-hook...
#    Set wallpaper on DP-2
#    Set wallpaper on eDP-1
#    Set wallpaper on wildcard
#    Set wallpaper using hyprpaper on 3 monitor(s): /path/to/wallpaper.jpg
```

## Integration with Hyprlock

When using both hyprpaper and hyprlock plugins together:

```bash
tinct generate -i image -p wallpaper.jpg -o hyprpaper,hyprlock
```

Both plugins receive the wallpaper path:
- **hyprpaper**: Generates config and applies wallpaper
- **hyprlock**: Includes `$tinct_wallpaper` variable in generated config

Example hyprlock usage:

```conf
# ~/.config/hypr/hyprlock.conf
source = ~/.config/hypr/tinct-hyprlock.conf

background {
    path = $tinct_wallpaper  # From tinct-hyprlock.conf
    colour = $tinct_background
    blur_passes = 3
}
```

## Example Workflow

### Daily Wallpaper Theme Update

```bash
#!/bin/bash
# Update theme from wallpaper

WALLPAPER="$HOME/.wallpaper"  # Your current wallpaper symlink

# Generate themes and apply wallpaper
tinct generate -i image -p "$WALLPAPER" \
  -o hyprland,hyprpaper,hyprlock,kitty,waybar

# hyprpaper automatically applies the wallpaper
# hyprlock gets the wallpaper path in its variables
# Other plugins get matching colour themes
```

### Multiple Wallpapers Per Monitor

```bash
# Generate base config
tinct generate -i image -p ~/Pictures/main-wallpaper.jpg -o hyprpaper

# Manually edit tinct-hyprpaper.conf for per-monitor setups
# Then source it in your main hyprpaper.conf
```

## Advanced Configuration

### Splash Screen

Enable splash text while wallpaper loads:

```conf
source = ~/.config/hypr/tinct-hyprpaper.conf

splash = true
splash_offset = 2.0
```

### IPC Control

Enable IPC for runtime wallpaper changes:

```conf
source = ~/.config/hypr/tinct-hyprpaper.conf

ipc = on
```

Then control via `hyprctl`:

```bash
# Reload specific wallpaper
hyprctl hyprpaper reload

# Change wallpaper at runtime
hyprctl hyprpaper preload ~/Pictures/new-wallpaper.jpg
hyprctl hyprpaper wallpaper "DP-1,~/Pictures/new-wallpaper.jpg"
```

## Resources

- [Hyprpaper Documentation](https://wiki.hyprland.org/Hypr-Ecosystem/hyprpaper/)
- [Hyprpaper GitHub](https://github.com/hyprwm/hyprpaper)
- [Hyprland Documentation](https://wiki.hyprland.org/)

## See Also

- [Hyprlock Plugin](../hyprlock/README.md) - Screen lock theming with wallpaper support
- [Hyprland Plugin](../hyprland/README.md) - Window manager colour theming
- [Image Input Plugin](../../input/image/README.md) - Extract colours from images
