# Templater Plugin

A flexible Tinct output plugin that can generate arbitrary files from custom templates using Go's text/template engine.

## Features

- **Multiple Templates**: Process any number of template files
- **Custom Output Paths**: Configure output location for each template
- **Go Template Engine**: Full access to Go's powerful text/template syntax
- **Template Functions**: All standard Tinct template functions (get, has, themeType, etc.)
- **Configuration File**: Define templates and outputs in a simple YAML/JSON config
- **Standalone Binary**: No dependencies, just a single executable

## Use Cases

- Generate config files for applications not yet supported by built-in plugins
- Create multiple related config files from a single palette
- Prototype new plugin templates before creating a full plugin
- Generate documentation with color swatches
- Create CSS/SCSS variables files
- Export to custom JSON/YAML formats

## Installation

### Build from Source

```bash
cd contrib/plugins/output/templater
go build -o /.local/share/tinct/plugins/tinct-plugin-templater
```

### Add to Tinct Plugin Config

Edit `~/.config/tinct/plugins.json`:

```json
{
  "external_plugins": {
    "templater": {
      "path": "/home/user/.local/share/tinct/plugins/templater",
      "type": "output",
      "version": "1.0.0"
    }
  },
  "enabled_plugins": [
    "output:templater"
  ]
}
```

## Configuration

The plugin uses a configuration file (default: `~/.config/tinct/templater.yaml`) that defines templates and their outputs.

### Configuration Format

```yaml
# Templater Configuration
# ~/.config/tinct/templater.yaml

templates:
  # Example 1: Generate a CSS variables file
  - name: "css-variables"
    description: "CSS custom properties for web projects"
    template_path: "~/.config/tinct/templates/css-vars.tmpl"
    output_path: "~/projects/myapp/src/styles/colors.css"
    enabled: true

  # Example 2: Generate SCSS variables
  - name: "scss-variables"
    description: "SCSS variables file"
    template_path: "~/.config/tinct/templates/scss-vars.tmpl"
    output_path: "~/projects/myapp/src/styles/_colors.scss"
    enabled: true

  # Example 3: Generate custom JSON theme
  - name: "custom-json"
    description: "Custom JSON theme format"
    template_path: "~/.config/tinct/templates/theme.json.tmpl"
    output_path: "~/.config/myapp/theme.json"
    enabled: false

  # Example 4: Generate documentation with color swatches
  - name: "theme-docs"
    description: "Theme documentation with color swatches"
    template_path: "~/.config/tinct/templates/theme-docs.md.tmpl"
    output_path: "~/projects/myapp/docs/THEME.md"
    enabled: true

  # Example 5: Generate i3 color configuration
  - name: "i3-colors"
    description: "i3 window manager color configuration"
    template_path: "~/.config/tinct/templates/i3-colors.tmpl"
    output_path: "~/.config/i3/colors"
    enabled: true

# Global settings
settings:
  # Create output directories if they don't exist
  create_dirs: true
  
  # Backup existing files before overwriting
  backup: true
  backup_suffix: ".backup"
  
  # Verbose output
  verbose: false
  
  # Template file permissions (octal)
  file_mode: 0644
```

## Template Examples

### Example 1: CSS Variables (`css-vars.tmpl`)

```css
/* Generated by Tinct - {{ .ThemeType }} theme */
/* Wallpaper: {{ .WallpaperPath }} */

:root {
  /* Base colors */
  --color-background: {{ (get . "background").Hex }};
  --color-foreground: {{ (get . "foreground").Hex }};
  
  /* Muted variants */
  --color-background-muted: {{ (get . "backgroundMuted").Hex }};
  --color-foreground-muted: {{ (get . "foregroundMuted").Hex }};
  
  /* Accent colors */
  {{ if has . "accent1" -}}
  --color-accent-1: {{ (get . "accent1").Hex }};
  --color-accent-1-rgb: {{ (get . "accent1").R }}, {{ (get . "accent1").G }}, {{ (get . "accent1").B }};
  {{ end -}}
  
  {{ if has . "accent2" -}}
  --color-accent-2: {{ (get . "accent2").Hex }};
  {{ end -}}
  
  {{ if has . "accent3" -}}
  --color-accent-3: {{ (get . "accent3").Hex }};
  {{ end -}}
  
  /* Semantic colors */
  {{ if has . "danger" -}}
  --color-danger: {{ (get . "danger").Hex }};
  {{ end -}}
  {{ if has . "warning" -}}
  --color-warning: {{ (get . "warning").Hex }};
  {{ end -}}
  {{ if has . "success" -}}
  --color-success: {{ (get . "success").Hex }};
  {{ end -}}
  {{ if has . "info" -}}
  --color-info: {{ (get . "info").Hex }};
  {{ end -}}
  
  /* Surface colors */
  {{ if has . "surface" -}}
  --color-surface: {{ (get . "surface").Hex }};
  --color-on-surface: {{ (get . "onSurface").Hex }};
  {{ end -}}
}
```

### Example 2: SCSS Variables (`scss-vars.tmpl`)

```scss
// Generated by Tinct - {{ .ThemeType }} theme
// Do not edit manually - changes will be overwritten

// Base colors
$background: {{ (get . "background").Hex }};
$foreground: {{ (get . "foreground").Hex }};
$background-muted: {{ (get . "backgroundMuted").Hex }};
$foreground-muted: {{ (get . "foregroundMuted").Hex }};

// Accent palette
$accent-1: {{ (get . "accent1").Hex }};
$accent-2: {{ (get . "accent2").Hex }};
$accent-3: {{ (get . "accent3").Hex }};
{{ if has . "accent4" -}}
$accent-4: {{ (get . "accent4").Hex }};
{{ end }}

// Semantic colors
$danger: {{ (get . "danger").Hex }};
$warning: {{ (get . "warning").Hex }};
$success: {{ (get . "success").Hex }};
$info: {{ (get . "info").Hex }};

// Color map for loops
$colors: (
  "background": $background,
  "foreground": $foreground,
  "accent-1": $accent-1,
  "accent-2": $accent-2,
  "accent-3": $accent-3,
  "danger": $danger,
  "warning": $warning,
  "success": $success,
  "info": $info
);
```

### Example 3: i3 Colors (`i3-colors.tmpl`)

```i3
# i3 color configuration - Generated by Tinct
# Theme: {{ .ThemeType }}

# class                 border                  background              text                    indicator               child_border
client.focused          {{ (get . "accent1").Hex }}  {{ (get . "accent1").Hex }}  {{ (get . "background").Hex }}  {{ (get . "accent2").Hex }}  {{ (get . "accent1").Hex }}
client.focused_inactive {{ (get . "surface").Hex }}  {{ (get . "surface").Hex }}  {{ (get . "foreground").Hex }}  {{ (get . "surface").Hex }}  {{ (get . "surface").Hex }}
client.unfocused        {{ (get . "background").Hex }}  {{ (get . "background").Hex }}  {{ (get . "foregroundMuted").Hex }}  {{ (get . "background").Hex }}  {{ (get . "background").Hex }}
client.urgent           {{ (get . "danger").Hex }}  {{ (get . "danger").Hex }}  {{ (get . "foreground").Hex }}  {{ (get . "warning").Hex }}  {{ (get . "danger").Hex }}
client.placeholder      {{ (get . "background").Hex }}  {{ (get . "background").Hex }}  {{ (get . "foreground").Hex }}  {{ (get . "background").Hex }}  {{ (get . "background").Hex }}

client.background       {{ (get . "background").Hex }}
```

### Example 4: Custom JSON Theme (`theme.json.tmpl`)

```json
{
  "name": "tinct-{{ .ThemeType }}",
  "type": "{{ .ThemeType }}",
  "wallpaper": "{{ .WallpaperPath }}",
  "colors": {
    "background": {
      "hex": "{{ (get . "background").Hex }}",
      "rgb": "{{ (get . "background").RGB }}",
      "r": {{ (get . "background").R }},
      "g": {{ (get . "background").G }},
      "b": {{ (get . "background").B }}
    },
    "foreground": {
      "hex": "{{ (get . "foreground").Hex }}",
      "rgb": "{{ (get . "foreground").RGB }}"
    },
    "accents": [
      {{- $first := true -}}
      {{- range $i := seq 1 4 -}}
        {{- $role := printf "accent%d" $i -}}
        {{- if has $ $role }}
          {{- if not $first }},{{ end }}
      {
        "name": "accent{{ $i }}",
        "hex": "{{ (get $ $role).Hex }}"
      }
          {{- $first = false -}}
        {{- end -}}
      {{- end }}
    ]
  }
}
```

## Usage

### Basic Usage

```bash
# Generate using default config
tinct generate --input image -p wallpaper.jpg --outputs templater

# With custom config location
tinct generate --input image -p wallpaper.jpg --outputs templater \
  --plugin-args 'templater={"config":"~/.config/tinct/my-templates.yaml"}'

# Verbose output
tinct generate --input image -p wallpaper.jpg --outputs templater \
  --plugin-args 'templater={"verbose":true}'

# Dry run (show what would be generated)
tinct generate --input image -p wallpaper.jpg --outputs templater --dry-run
```

### Plugin Arguments

The plugin accepts the following arguments via `--plugin-args`:

```json
{
  "config": "~/.config/tinct/templater.yaml",  // Config file path
  "verbose": true,                                      // Verbose output
  "templates": ["css-variables", "scss-variables"],     // Only process specific templates
  "skip": ["theme-docs"]                                // Skip specific templates
}
```

## Template Functions

All standard Tinct template functions are available:

- `get` - Get color by role: `{{ (get . "background").Hex }}`
- `has` - Check if role exists: `{{ if has . "accent4" }}`
- `themeType` - Get theme type string: `{{ themeType . }}`
- `seq` - Generate sequence: `{{ range seq 1 4 }}`
- Color format methods: `.Hex`, `.RGB`, `.RGBA`, `.HexNoHash`, `.R`, `.G`, `.B`, `.A`

## Template Data Structure

Templates receive a `ThemeData` object with:

```go
type ThemeData struct {
    PaletteHelper *PaletteHelper  // Access to all colors and functions
    WallpaperPath string           // Path to source wallpaper (if any)
    ThemeName     string           // Theme name (empty for templater)
}
```

Access colors using the helper methods:
- `get . "roleName"` - Get color by role
- `has . "roleName"` - Check if role exists
- `.ThemeType` - Returns theme type string ("dark" or "light")
- `.WallpaperPath` - Returns wallpaper path

## Directory Structure

```
~/.config/tinct/
├── templater.yaml          # Main configuration
└── templates/                       # Template files
    ├── css-vars.tmpl
    ├── scss-vars.tmpl
    ├── i3-colors.tmpl
    ├── theme.json.tmpl
    └── theme-docs.md.tmpl
```

## Development

### Project Structure

```
templater/
├── main.go                 # Main entry point
├── config.go              # Configuration loading
├── template.go            # Template processing
├── go.mod                 # Go module definition
├── go.sum                 # Go dependencies
└── README.md              # This file
```

### Building

```bash
cd contrib/plugins/output/templater
go mod init github.com/jmylchreest/tinct/contrib/plugins/output/templater
go mod tidy
go build -o tinct-plugin-templater
```

### Testing

```bash
# Test plugin info
./templater --plugin-info

# Test with sample palette
cat testdata/sample-palette.json | ./templater
```

## License

MIT - See LICENSE file in the Tinct repository
